filter {
  # parse the 'published' (now string) back as @timestamp for ElasticSearch & Kibana
  date { 
    match => ["published", "ISO8601" ]
    timezone => 'UTC'
    remove_field => [ "published" ]
  }

  # We don't care for 'updated' anymore
  # Removing also logstash's internal '@version' field, cf.: https://github.com/elastic/logstash/issues/3866
  mutate { remove_field => [ "updated", "@version" ] }  

}

output {
  elasticsearch { 
    hosts => ["elasticsearch:9200"] 
    index => "logstash-%{+YYYY.MM}"

    # default type derived from event[type] = rss, tweet, ...
    #document_type = %{type}

    # avoid duplicates
    # NOTE: It seems that the Node Ingest API only works with "index" but not "update"
    #action => "update"
    doc_as_upsert => true
    document_id => "%{[id]}"
  }
}
